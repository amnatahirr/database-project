
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: black;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background-color:black;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
        color: #333;
    }

    h2 {
        text-align: center;
        color: #555;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    thead {
        background-color: #007bff;
        color: white;
    }

    th,
    td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    tr:hover {
        background-color:lightblue;
    }

    .btn {
        padding: 8px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-danger {
        background-color: #e74c3c;
        color: white;
    }

    .btn-danger:hover {
        background-color: #c0392b;
    }
</style>

<div class="container">
    <h1>Employer Dashboard</h1>
    <h2>All Job Applications</h2>

    <table id="applicationsTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Applicant Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Job Title</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data rows will be populated here dynamically -->
        </tbody>
    </table>
</div>

<!-- Modal for Delete Confirmation (optional for deleting applications) -->
<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span id="closeModal" class="close-btn">&times;</span>
        <h2>Confirm Deletion</h2>
        <p>Are you sure you want to delete this application?</p>
        <button id="confirmDelete" class="btn btn-danger">Yes, Delete</button>
        <button id="cancelDelete" class="btn">Cancel</button>
    </div>
</div>

<script>
    // This function fetches applications from the backend API and displays them
    document.addEventListener("DOMContentLoaded", async () => {
        const applicationsTable = document.querySelector("#applicationsTable tbody");

        try {
            const response = await fetch("/application/employer/getall", {
                method: "GET",
                headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
            });

            const data = await response.json();

            if (data.success) {
                const applications = data.applications;
                applications.forEach((app, index) => {
                    const row = document.createElement("tr");

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${app.applicantName || "N/A"}</td>
                        <td>${app.email || "N/A"}</td>
                        <td>${app.phone || "N/A"}</td>
                        <td>${app.jobTitle || "N/A"}</td>
                        <td>${app.status || "Pending"}</td>
                        <td><button class="btn btn-danger" data-id="${app._id}">Delete</button></td>
                    `;

                    applicationsTable.appendChild(row);
                });

                // Add event listeners to delete buttons
                document.querySelectorAll(".btn-danger").forEach((button) => {
                    button.addEventListener("click", async () => {
                        const applicationId = button.getAttribute("data-id");
                        showDeleteModal(applicationId);
                    });
                });
            } else {
                alert("Failed to fetch applications");
            }
        } catch (err) {
            console.error("Error fetching applications:", err);
            alert("An error occurred while fetching applications.");
        }
    });

    // Function to show delete confirmation modal
    function showDeleteModal(applicationId) {
        const deleteModal = document.getElementById("deleteModal");
        deleteModal.style.display = "block";
        document.getElementById("confirmDelete").setAttribute("data-id", applicationId);
    }

    // Handle confirm delete button click
    document.getElementById("confirmDelete").addEventListener("click", async () => {
        const applicationId = document.getElementById("confirmDelete").getAttribute("data-id");
        try {
            const response = await fetch(`/application/delete/${applicationId}`, {
                method: "DELETE",
                headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
            });

            const data = await response.json();
            if (data.success) {
                alert("Application deleted successfully!");
                window.location.reload(); // Reload to update the application list
            } else {
                alert("Failed to delete application");
            }
        } catch (err) {
            console.error("Error deleting application:", err);
            alert("An error occurred while deleting the application.");
        }
    });

    // Handle cancel delete button click
    document.getElementById("cancelDelete").addEventListener("click", () => {
        document.getElementById("deleteModal").style.display = "none";
    });

    // Close the modal when clicking the close button
    document.getElementById("closeModal").addEventListener("click", () => {
        document.getElementById("deleteModal").style.display = "none";
    });
</script>


